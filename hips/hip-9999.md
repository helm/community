---
hip: 9999
title: "Helm lock release"
authors: [ "Justin Garrison <justinleegarrison@gmail.com>" ]
created: "2021-03-08"
type: "feature"
status: "draft"
---

## Abstract

Helm lock will allow chart consumers to keep a deployed Helm chart — a helm release — at a version of their choice.

## Motivation

Helm currently will automatically upgrade a relesae to the latest published chart version in a repository.
This allows users to always stay up to date, but it does not allow safety guarantees for consumers when charts have breaking changes.

Some charts will have breaking changes because of Kubernetes version changes or some will have CRD changes to remediate design flaws or critical implementation bugs.
Users can specify a `--version` when creating a release or performing an upgrade, but it is not possible to centrally know which releases need a specific version or what that version is.

Chart authors can add deprecation messages to their charts (e.g. [gitlab does this](https://docs.gitlab.com/charts/architecture/decisions.html#breaking-changes-via-deprecation)) but it doesn't stop users from upgrading to releases without deprecation messages.
It doesn't allow users to stay on `*-stable` or specific versions that are compatible with other parts of their Kubernetes clusters.

## Rationale

If helm is "the package manager for Kubernetes" it should have similar package manager features that users are used to such as `apt` and `yum`.
With both of those package managers there is a centralized way to specify a version of a package and keep that version installed even when a user runs a system wide `upgrade` command.
Centralizing the version locking guarantees that all users, automation, and libraries that use the package manager also honor the version locks in place.

Making something native in helm that supports locking will be critical as users consume helm charts via other tools and workflows (e.g. gitops via `flux`).
It will reduce errors because `helm` commands can be run from any users machine with access to the cluster.

Helm releases do not have the same constraints has traditional package managers.
A cluster can have multiple versions of a chart deployed in different namespaces and each release can have various dependencies.
Because releases are self-contained state storeage on a per-release basis version locking information should also exist within the release metadata and be read and processed during template rendering.

## Specification

To implement version locking on a release an optional field should be added to the release secret that specifies a desired version.

```
apiVersion: v1                                                                                                                                                                                                                              
data:                                                                                                                                                                                                                                       
  release: SDRzSUF...
kind: Secret
metadata:
  creationTimestamp: "2021-02-23T18:07:25Z"
  labels:
    modifiedAt: "1614103661"
    name: ingress
    owner: helm
    status: deployed
    version: "1"
    desiredVersion: "1" 
  name: sh.helm.release.v1.ingress.v1
  namespace: default
  resourceVersion: "47331598"
  selfLink: /api/v1/namespaces/default/secrets/sh.helm.release.v1.ingress.v1
  uid: 07ba4723-1cd1-43a8-a322-7d8e25f0868e
type: helm.sh/release.v1

## Backwards compatibility

Describe potential impact and severity on pre-existing code.

## Security implications

How could a malicious user take advantage of this new feature?

## How to teach this

How to teach users, new and experienced, how to apply the HIP to their work.

## Reference implementation

Link to any existing implementation and details about its state, e.g.
proof-of-concept.

## Rejected ideas

Why certain ideas that were brought while discussing this HIP were not
ultimately pursued.

## Open issues

Any points that are still being decided/discussed.

## References

* [`apt mark` man page](http://manpages.ubuntu.com/manpages/bionic/man8/apt-mark.8.html)
* [`yum versionlock` man page](https://man7.org/linux/man-pages/man1/yum-versionlock.1.html)
